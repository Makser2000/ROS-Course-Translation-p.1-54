# 3. Выполнение задач с использованием ROS

Как мы обнаружили в томе 1, относительно просто программировать робота на выполнение определенных действий, такие как отслеживание лиц, навигация между местами, или следование за человеком. Но от полностью автономного робота ожидается, что он сам выберет себе действия из более широкого репертуара поведения в зависимости от поставленной задачи и от текущих условий.

В этой главе мы узнаем, как использовать два различных способа выполнения задач с поддержкой ROS - фреймворков: [SMACH](http://wiki.ros.org/smach) \(использование машин состояний\) и [pi\_trees ](http://wiki.ros.org/pi_trees)\(поведенческие деревья\). Каждый подход имеет свои сильные и слабые стороны, и может показаться легче или сложнее в зависимости от вашего опыта программирования. Но оба метода обеспечивают более структурированный подход к управлению задачами, чем просто написание большого списка из If-then утверждений .

Контроллер общих задач часто называют исполнителем задач и большинство таких исполнителей должны включать, по крайней мере, следующие ключевые характеристики:

* **приоритеты задач:** более низкая приоритетная задача должна быть вытеснена, если более высокая приоритетная задача требует тех же ресурсов \(например, приводные двигатели\).
* **пауза и возобновление:** часто желательно приостановить выполнение текущей задачи \(или

  задач\), когда более приоритетная задача получает контроль, а затем возобновить работу

  вытесненной задач\(и\), когда исполнительный орган возвращает контроль. Например, 

  пылесос Neato способен вернуться на то место, где он остановился после подзарядки.

* **иерархия задач:** задачи часто можно разбить на подзадачи, чтобы разобраться в них поподробнее. Например, задача высокого уровня под названием перезарядка может состоять из трех частей: перейдите к док-станции, закрепите робота и зарядите его батарею. Аналогично, задача стыковки может быть разбита на: выравнивание по

  маяку; движение вперед; остановка при состыковке.

*  **условия:** как данные датчика, так и внутренние переменные программирования могут содержать ограничения по времени и способу выполнения задачи. В ROS эти переменные

  часто принимают форму сообщений, публикуемых различными узлами. Например, задача мониторинга батареи будет подписана на раздел диагностики, который включает в себя текущий уровень заряда батареи. При обнаружении низкого уровня заряда батареи проводится проверка состояния и задача подзарядки начнет выполняться в то время как другие задачи приостанавливаются или прерываются.

* **параллелизм:** несколько задач могут выполняться параллельно. Например, задача навигации \(переход к следующей точке маршрута\) и задача контроля за зарядом аккумулятора должны работать в одно и то же время.

Для конкретизации мы будем использовать два примера сценариев на протяжении всей главы:     " Патрульный бот ", который должен посетить ряд мест последовательно, сохраняя при этом свою батарею и " Робот для уборки дома", который должен посетить несколько комнат и выполнять различные уборки, относящиеся к каждой комнате.

